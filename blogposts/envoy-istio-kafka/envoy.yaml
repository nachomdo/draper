node:
  cluster: test-cluster
  id: test-id

dynamic_resources:
  ads_config:
    api_type: GRPC
    transport_api_version: V3
    grpc_services:
    - envoy_grpc:
        cluster_name: xds_cluster
  cds_config:
    resource_api_version: V3
    ads: {}
  lds_config:
    resource_api_version: V3
    ads: {}

static_resources:
  listeners:
    - address:
        socket_address:
          address: 0.0.0.0
          port_value: 12344
      filter_chains:
        - filters:
          - name: envoy.filters.network.tcp_proxy
            typed_config:
              "@type": type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy
              stat_prefix: kafka_primary_stats
              weighted_clusters:
                clusters:
                - name: kafka_primary
                  weight: 50
                - name: kafka_secondary
                  weight: 50

    - address:
        socket_address:
          address: 0.0.0.0 # Host that Kafka clients should connect to.
          port_value: 12345  # Port that Kafka clients should connect to.
      filter_chains:
        - filters:
          - name: envoy.filters.network.kafka_mesh
            typed_config:
              "@type": type.googleapis.com/envoy.extensions.filters.network.kafka_mesh.v3alpha.KafkaMesh
              advertised_host: "localhost"
              advertised_port: 12345
              upstream_clusters:
                - cluster_name: primary
                  bootstrap_servers: broker:29092
                  partition_count: 1
                - cluster_name: secondary
                  bootstrap_servers: alt_broker:19098
                  partition_count: 1
              forwarding_rules:
                - target_cluster: primary
                  topic_prefix: apples
                - target_cluster: secondary
                  topic_prefix: bananas
  clusters:
  - type: STRICT_DNS
    name: kafka_primary
    load_assignment:
      cluster_name: kafka_primary
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                address: broker
                port_value: 29092

  - type: STRICT_DNS
    name: kafka_secondary
    load_assignment:
      cluster_name: kafka_secondary
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                address: alt_broker
                port_value: 19098

  - type: STRICT_DNS
    typed_extension_protocol_options:
      envoy.extensions.upstreams.http.v3.HttpProtocolOptions:
        "@type": type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions
        explicit_http_config:
          http2_protocol_options: {}
    name: xds_cluster
    load_assignment:
      cluster_name: xds_cluster
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                address: go-control-plane
                port_value: 18000

admin:
  address:
    socket_address:
      address: 0.0.0.0
      port_value: 19000
